<div class="container pt-5 mt-5">
<h2 class="text-center">Mon calendrier</h2>
<%= form_tag url_for(action: 'create'), method: "post" do %>
  <%= label_tag "Date de début" %><br>
  <%= date_field_tag :start_date, nil, class: "form-control w-25 " %>
  <%= label_tag "Date de fin" %><br>
  <%= date_field_tag :end_date, nil, class: "form-control w-25" %>

  <%= submit_tag "Valider", class: "btn text-uppercase my-4 w-25 mx-auto font-weight-bold text-white", style: "background-color:#D1410C"  %>
<% end %>

  <%= month_calendar events: @bookings do |date, bookings| %> 
    <% available = [] %>
    <% non_available = [] %>
    <% @availabilities.each do |availability| %>
      <% if availability.start_date > date || availability.end_date < date%>
        <% non_available << date %>
      <% else %>
        <% available << date %>
      <%end %>
    <% end%>
    <% if available.empty? %>
      <%= content_tag :div, class: "calendar-day text-danger", data: {date: date} do %>
        <%= non_available[0].strftime('%d/%m/%y') %>
        <p>Indisponible</p>
      <%end%>
    <%else%>
      <%= content_tag :div, class: "calendar-day text-success", data: {date: date} do %>
        <%= non_available[0].strftime('%d/%m/%y') %>
      <%end%>
    <%end%>
    <% bookings.each do |booking| %>  
        <div>
          <%= booking.start_date.strftime('%H:%M') %>
          <%= booking.user.first_name %>
          <%= booking.user.last_name %> 
        </div>  
      <% end %>
  <% end %>

<h2 class="text-center">Mes événements</h2>
<% if @bookings.where(start_date: DateTime.now..DateTime::Infinity.new, status: "approved").empty? %>
    <p class="text-center text-secondary py-4">Vous n'avez pas de réservation à venir.</p>
  <% else %>
    <table class="table table-hover">
      <thead>
      <tr>
        <th scope="col">#</th>
        <th scope="col">Email Client</th>
        <th scope="col">Date de l'événement</th>
        <th scope="col">Description de l'événement</th>
        <th scope="col">Montant</th>
        <th scope="col">Statut</th>
        <th scope="col">Annuler</th>
      </tr>
    </thead>
      <tbody>
        <% @bookings.where(start_date: DateTime.now..DateTime::Infinity.new, status: "approved").each do |booking| %>
          <tr>
            <th scope="row"><%= booking.id %></th>
              <td><%= booking.user.email %></td>
              <td><%= booking.start_date.strftime("%d/%m/%Y") %></td>
              <td><%= booking.description %></td>
              <td><%= number_to_currency(booking.duration * current_artist.hourly_price, unit: "€", separator: ",", delimiter: "", format: "%n %u") %></td>
              <td><%= booking.status %></td>
              <td><%= link_to "Annuler", artist_booking_path(artist_id: current_artist.id, id: booking.id), method: :delete, class: "btn btn-danger btn-sm" %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>
</div>

<script>

document.addEventListener("DOMContentLoaded", function() {
  let table = document.getElementsByClassName("day");
  console.log(table);
  for(let i = 0; i < table.length; i++){
  table[i].style.cursor = "pointer";
  table[i].onclick = function() {
    console.log(`cell ${i} clicked`);
  };
  }
}, false);
</script>